<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:replace="/include/header.html"></div>
<div class="container d-flex flex-row">
    <div th:replace="/mypage/mypageSidebar.html"></div>
    <div style="width: 100%">
        <h2>전화번호변경</h2>
        <div>현재 전화번호: </div>
        <div th:text="${user.userPhoneNumber}"></div>
        <div th:text="${msg}"></div>
<!--        <button class="btn btn-primary" type="button" onclick="checkDoubleEmail()">중복확인</button>-->
        <span id="phoneCheck" style="color: #ee1c25; font-size: 13.125px; line-height: 34px;"></span>
    </div>
    <form action="/mypage/change-phone-number" method="post">
        <!--        <input type="hidden" th:name="_csrf" th:value="${_csrf.token}"/>-->
<!--        <div class="form-group">-->
<!--            <label>변경할이메일:</label>-->
<!--            <input  type="text" class="form-control" name="email" id="email">-->
<!--        </div>-->
        <div class="form-group">
            <label for="userPhoneNumber">휴대폰:</label>
<!--            <input class="form-control" th:field="*{userPhoneNumber}" placeholder="숫자만 입력해주세요" type="text">-->
            <input class="form-control" name="userPhoneNumber" id="userPhoneNumber" placeholder="숫자만 입력해주세요" type="text">
            <button class="btn btn-primary" type="button" th:field="${code}" onclick="phoneAuth()">인증번호받기</button>
            <span id="phoneCheck" style="color: #ee1c25; font-size: 13.125px; line-height: 34px;"></span>
            <input type="text" name="code" id="code">
            <button type="button" onclick="phoneAuthOk()">확인</button>
        </div>


        <div class="form-group">
            <label for="password">비밀번호:</label>
            <input type="password" class="form-control" id="password" placeholder="현재 비밀번호를 입력해주세요" name="password">
        </div>
        <button type="submit" class="btn btn-primary">확인</button>
    </form>

</div>
<div th:replace="/include/footer.html"></div>

<script>
    function phoneAuth(){
        $.ajax({
            type:'POST',
            url:"/api/phoneAuth",
            data: JSON.stringify($("#userPhoneNumber").val()),
            dataType:"json",
            contentType:"application/json;charset=utf=8"
        })
            .done(function(resp){
                resp ? $("#phoneCheck").html("전화테스트1") : $("#phoneCheck").html("문자를 발송하였습니다.");
            })
            .fail(function(e){
                alert("error")
            })
    }
    function phoneAuthOk(){
        $.ajax({
            type:'POST',
            url:"/api/phoneAuthOk",
            data:'code='+$('#code').val()
            // dataType:"json",
            // contentType:"application/json;charset=utf=8"
        })
            .done(function(resp){
                resp ? $("#phoneCheck").html("잘못입력하셨습니다.") : $("#phoneCheck").html("인증완료");
            })
            .fail(function(e){
                alert("인증을 다시 시도해 주세요")
            })
    }

</script>
</body>


